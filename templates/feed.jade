doctype xml
rss(version='2.0',
    xmlns:content='http://purl.org/rss/1.0/modules/content/',
    xmlns:wfw='http://wellformedweb.org/CommentAPI/',
    xmlns:dc='http://purl.org/dc/elements/1.1/'
    xmlns:atom='http://www.w3.org/2005/Atom')
  channel
    - var photos = _.chain(contents.photography._.directories).map(function(item) {
    -   return item.index;
    - }).compact().value();

    - var posts = _.chain(contents.journal._.directories).map(function(item) {
    -   return item.index;
    - }).compact().value();

    - var entries = photos.concat(posts);
    - entries = _.chain(entries).sortBy(function(item) {
    -   return -item.date;
    - }).first(10).value();

    title katzki.de
    atom:link(href=locals.url + '/feed.xml', rel='self', type='application/rss+xml')
    link= locals.url
    description= locals.description
    pubDate= entries[0].rfc822date
    language en
    for entry in entries
      - var permalink = locals.url + entry.url
      item
        title= entry.title
        link= permalink
        pubDate= entry.rfc822date
        guid(isPermaLink='true')= permalink
        if (entry.metadata.category == 'journal')
          description= entry.getHtml(locals.url)
        else
          description
            a(href='#{locals.url}#{entry.url}', title=entry.title)
              img(src='#{locals.url}#{entry.url}photo.jpg', alt=entry.title)